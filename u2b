#!/usr/bin/perl
# Copyright: SZABO Gergely <szg@subogero.com>, GNU GPL v2
if ($ARGV[0] eq '-h') {
    $html = 1;
    shift;
}
$query = 'https://gdata.youtube.com/feeds/api/videos?q=';
$query .= join '%20', @ARGV;
$xml = `curl $query 2>/dev/null`;
$i = 0;
while ($xml =~ m|^.*?<media:group>(.+?)</media:group>(.*)|s) {
    $xml = $2;
    my $vid = $1;
    $vid =~ m|<media:content url='([^']+?)'[^>]+?yt:format='6' ?/>|;
    my $url = $1;
    $vid =~ m|<media:title type='plain'>(.+?)</media:title>|;
    my $title = $1;
    $vid =~ m|<media:thumbnail url='([^']+?)' height='90'[^>]+?/>|;
    my $thumbnail = $1;
    if ($html) {
        print <<EOF;
<p>
<a href="$url">$title</a>
<br>
<img src="$thumbnail"/>
</p>
EOF
    } else {
        print "[$i]\ntitle=$title\nurl=$url\nthumbnail=$thumbnail\n";
    }
    $i++;
}
